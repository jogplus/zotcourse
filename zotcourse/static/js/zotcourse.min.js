const MONTH_TO_INT={Jan:0,Feb:1,Mar:2,Apr:3,May:4,Jun:5,Jul:6,Aug:7,Sep:8,Oct:9,Nov:10,Dec:11},WEEKDAY_TO_STRING={1:"MO",2:"TU",3:"WE",4:"TH",5:"FR"},MON=1,TUE=2,WED=3,THU=4,FRI=5,COURSE_EVENT_TYPE=0,CUSTOM_EVENT_TYPE=1,ANTPLANNER_EVENT_TYPE=2,LISTING_CODE_INDEX=0,LISTING_TYPE_INDEX=1,LISTING_UNITS_INDEX=3,LISTING_INSTRUCTOR_INDEX=4,LISTING_TIME_INDEX=5,LISTING_ROOM_INDEX=6,LISTING_FINAL_INDEX=7;function S4(){return(65536*(1+Math.random())|0).toString(16).substring(1)}function ParsedCourseTime(t){var e=t.split("-"),o=e[0].split("&nbsp;"),n=$.trim(o[o.length-1]),a=$.trim(e[1]),r=parseInt(n.split(":")[0]),i=parseInt(n.split(":")[1]),l=parseInt(a.split(":")[0]),s=parseInt(a.split(":")[1].replace("p","")),d=-1!=a.indexOf("p"),c=[];(-1!=t.indexOf("M")&&c.push(MON),-1!=t.indexOf("Tu")&&c.push(TUE),-1!=t.indexOf("W")&&c.push(WED),-1!=t.indexOf("Th")&&c.push(THU),-1!=t.indexOf("F")&&c.push(FRI),d)&&((12==l?12:l+12)-r>5&&(r+=12),12!=l&&(l+=12));return{start:r+":"+("0"+i).slice(-2),end:l+":"+("0"+s).slice(-2),days:c}}function FinalParsedCourseTime(t){var e=t.split(","),o=e[2].split("-"),n=$.trim(e[1]),a=n.split(" ")[0],r=parseInt(n.split(" ")[1]),i=$.trim(o[0]),l=$.trim(o[1]),s=parseInt(i.split(":")[0]),d=parseInt(i.split(":")[1]),c=parseInt(l.split(":")[0]),u=parseInt(l.split(":")[1].replace("pm","")),p=-1!=l.indexOf("pm"),h=-1;(-1!=t.indexOf("Sun")&&(h=0),-1!=t.indexOf("Mon")&&(h=1),-1!=t.indexOf("Tue")&&(h=2),-1!=t.indexOf("Wed")&&(h=3),-1!=t.indexOf("Thu")&&(h=4),-1!=t.indexOf("Fri")&&(h=5),-1!=t.indexOf("Sat")&&(h=6),p)&&((12==c?12:c+12)-s>5&&(s+=12),12!=c&&(c+=12));return{beginHour:s,beginMin:d,endHour:c,endMin:u,weekDay:h,month:a,day:r,date:n}}function parseRoomString(t){var e=(t=t.trim()).match(/(\w|\s)+(?=<|$)/g)||[];return t.match(/<a.*?>.*?<\/a>/g)||e}function CourseTimeStringParser(t,e){var o=[],n=t.split("<br>"),a=parseRoomString(e);for(var r in n){var i="TBA";if(r in a&&a[r].length>0&&(i=a[r]),-1==n[r].indexOf("TBA")){var l=ParsedCourseTime(n[r]);l.room=i,o.push(l)}}return o}function getRandomColorPair(){var t=[{color:"#C4A883",borderColor:"#B08B59"},{color:"#A7A77D",borderColor:"#898951"},{color:"#85AAA5",borderColor:"#5C8D87"},{color:"#94A2BE",borderColor:"#5C8D87"},{color:"#8997A5",borderColor:"#627487"},{color:"#A992A9",borderColor:"#8C6D8C"},{color:"#A88383",borderColor:"#A87070"},{color:"#E6804D",borderColor:"#DD5511"},{color:"#F2A640",borderColor:"#EE8800"},{color:"#E0C240",borderColor:"#D6AE00"},{color:"#BFBF4D",borderColor:"#AAAA11"},{color:"#8CBF40",borderColor:"#66AA00"},{color:"#4CB052",borderColor:"#109618"},{color:"#65AD89",borderColor:"#329262"},{color:"#59BFB3",borderColor:"#22AA99"},{color:"#668CD9",borderColor:"#3366CC"},{color:"#668CB3",borderColor:"#336699"},{color:"#8C66D9",borderColor:"#6633CC"},{color:"#B373B3",borderColor:"#994499"},{color:"#E67399",borderColor:"#DD4477"},{color:"#D96666",borderColor:"#CC3333"}];return t[Math.floor(Math.random()*t.length)]}function isCourseAdded(t,e){var o=$("#cal").fullCalendar("clientEvents");for(var n in o){if(o[n].groupId===t&&o[n].final!==e){for(var a in $("#cal").fullCalendar("removeEvents",o[n]._id),o[n].courseTimes){var r=o[n].courseTimes[a];$("#cal").fullCalendar("renderEvent",{_id:o[n]._id,id:o[n].id,groupId:o[n].groupId,start:r.start,end:r.end,title:o[n].title,dow:r.days,color:o[n].color,daysOfTheWeek:r.days,location:r.room,fullName:o[n].fullName,instructor:o[n].instructor,final:e,units:o[n].units,courseTimes:o[n].courseTimes,eventType:o[n].eventType})}return toastr.success("Updated Course Final"),!0}if(o[n].groupId===t)return toastr.warning("Course Already Added"),!0}return!1}function getInstructorArray(t){for(var e=t.split("<br>"),o=[],n=0;n<e.length;n++)"STAFF"===e[n]?o.push("STAFF"):""!==e[n]&&o.push($(e[n]).html());return o}function createInstructorLinks(t){for(var e=[],o=0;o<t.length;o++){var n=t[o].trim();if("STAFF"==n||"N/A (due to import)"==n)e.push(n);else{var a=n.split(",")[0];-1!==a.indexOf("-")&&(a=n.split("-")[0]);var r="https://www.ratemyprofessors.com/search.jsp?queryoption=HEADER&queryBy=teacherName&schoolName=University+of+California+Irvine&schoolID=1074&query="+a;e.push('<a class="instructor-link" href="'+r+'" target="_blank">'+n+"</a>")}}return e.join("<br>")}function saveSchedule(t){var e=$("#cal").fullCalendar("clientEvents"),o=[],n=[];if(0!=e.length)if(null==t||t.length<5)toastr.warning("Must be at least 5 characters.","Schedule Name Too Short");else{for(var a in e)if(!(n.indexOf(e[a].groupId)>=0)){var r={id:e[a].id,groupId:e[a].groupId,title:e[a].title,start:e[a].start.format("HH:mm"),end:e[a].end.format("HH:mm"),color:e[a].color,location:e[a].location,fullName:e[a].fullName,instructor:e[a].instructor,final:e[a].final,dow:e[a].daysOfTheWeek,daysOfTheWeek:e[a].daysOfTheWeek,units:e[a].units,courseTimes:e[a].courseTimes,eventType:e[a].eventType};o.push(r),n.push(e[a].groupId)}$.ajax({url:"/schedules/add",type:"POST",data:{username:t,data:JSON.stringify(o)},success:function(e){e.success&&(toastr.success(t,"Schedule Saved!"),localStorage.setItem("username",t),addToRecentSchedules(t),$("#scheduleNameForPrint").html("Zotcourse schedule name: "+t))},error:function(e){toastr.error(t,"Schedule Not Saved")}})}else toastr.warning("Must add at least one course.","Empty Schedule")}function loadSchedule(t){null!=t&&""!=t?$.ajax({url:"/schedule/load",data:{username:t},success:function(e){if(e.success){var o=JSON.parse(e.data);$("#cal").fullCalendar("removeEvents"),$("#finals").fullCalendar("removeEvents");for(var n=0,a=0;a<o.length;a++){if(o[a].courseTimes)for(var r=0;r<o[a].courseTimes.length;r++)o[a].start=o[a].courseTimes[r].start,o[a].end=o[a].courseTimes[r].end,o[a].dow=o[a].courseTimes[r].days,o[a].location=o[a].courseTimes[r].room,$("#cal").fullCalendar("renderEvent",o[a]);else $("#cal").fullCalendar("renderEvent",o[a]);o[a].units&&(n+=parseInt(o[a].units))}$("#unitCounter").text(n),$("#scheduleNameForPrint").html("Zotcourse schedule name: "+t),toastr.success(t,"Schedule Loaded!"),localStorage.setItem("username",t),addToRecentSchedules(t),switchToMainCalendar()}},error:function(e){toastr.error(t,"Schedule Not Found")}}):toastr.error(t,"Schedule Not Found")}function loadAPSchedule(t){""!=t&&$.ajax({url:"/schedule/loadap",data:{username:t},success:function(e){if(e.success){$("#cal").fullCalendar("removeEvents");for(var o=0;o<e.data.length;o++){e.data[o].color=getRandomColorPair().color;var n=e.data[o].title.split("<br>")[0].split(" at ");e.data[o].location=n[1],e.data[o].eventType=ANTPLANNER_EVENT_TYPE,e.data[o].title=n[0].replace("&amp;","&")}$("#cal").fullCalendar("renderEvents",e.data),$("#scheduleNameForPrint").html(t),toastr.success(t,"Schedule Loaded!"),switchToMainCalendar(),$("#unitCounter").text(0)}else toastr.error(t,"Schedule Not Found")}})}function switchToMainCalendar(){$("#finals-btn").hasClass("active")&&($("#finals").hide(),$("#cal").show(),$("#finals-btn").removeClass("active"),$("#cal").fullCalendar("rerenderEvents"))}function daysOfTheWeekToStr(t){var e=[];for(var o in t)e.push(WEEKDAY_TO_STRING[t[o]]);return e}function sleep(t){return new Promise(e=>setTimeout(e,t))}function addToRecentSchedules(t){var e=JSON.parse(localStorage.getItem("recentSchedules"));indexOfScheduleName=e.indexOf(t),-1===indexOfScheduleName?(e.unshift(t),e.length>5&&e.pop()):(e.splice(indexOfScheduleName,1),e.unshift(t)),localStorage.setItem("recentSchedules",JSON.stringify(e))}function arrToTable(t){var e='<tr><td style="color:rgb(206, 212, 218)">Empty</tr></td>';return"[]"!==t&&(e=t.replace(/",/g,"</a></td></tr><tr><td><a class='recentSchedule' href='#'>").replace('["',"<tr><td><a class='recentSchedule' href='#'>").replace('"]',"</a></td></tr>").replace(/"/g,"")),'<table style="width:100%">\t\t\t\t<tr style="border-bottom:solid 1px"><th>Recent Schedules</th><th><a id="clearRecents" href="#">Clear All<a></th></tr>\t\t\t\t'+e+"\t\t\t</table>"}function swapToListing(t){$("#search").hide(),$("#loading").hide(),$("#soc").html(t),$("#soc").show()}function setupListingListeners(){var t=$(".course-list",$("#right").contents()),e=$("tr[valign*='top']:not([bgcolor='#fff0ff'])",t);e.hover(function(){$(this).css({color:"#ff0000",cursor:"pointer"})},function(){$(this).css({color:"#000000",cursor:"default"})}),e.on("click",function(){var t=CourseTimeStringParser($(this).find("td").eq(LISTING_TIME_INDEX).html(),$(this).find("td").eq(LISTING_ROOM_INDEX).html());if(0!=t.length){var e=$(this).find("td").eq(LISTING_CODE_INDEX).text(),o=$.trim($(this).prevAll().find(".CourseTitle").last().html().split("<font")[0].replace(/&nbsp;/g,"").replace(/&amp;/g,"&")),n=$(this).prevAll().find(".CourseTitle").last().find("b").html(),a=$(this).find("td").eq(LISTING_TYPE_INDEX).html(),r=getInstructorArray($(this).find("td").eq(LISTING_INSTRUCTOR_INDEX).html()),i=$(this).find("td").eq(LISTING_FINAL_INDEX).html().replace(/&nbsp;/g,"").trim(),l=$(this).find("td").eq(LISTING_UNITS_INDEX).html(),s=getRandomColorPair();if(!isCourseAdded(e,i)){$("#unitCounter").text(parseInt($("#unitCounter").text())+parseInt(l));var d=S4();for(var c in t){var u=t[c];$("#cal").fullCalendar("renderEvent",{id:d,groupId:e,start:u.start,end:u.end,title:a+" "+o,dow:u.days,color:s.color,daysOfTheWeek:u.days,location:u.room,fullName:n,instructor:r,final:i,units:l,courseTimes:t,eventType:COURSE_EVENT_TYPE})}switchToMainCalendar()}}else toastr.warning("Course is TBA")}),$(".course-list td a").click(function(t){t.stopPropagation()}),$(".same-link").on("click",function(t){t.preventDefault(),$.ajax({url:$(this).attr("href"),type:"GET",success:function(t){swapToListing(t),cleanListing(),setupListingListeners(),mobileRescale()},error:function(){toastr.error("Cannot load classes")}})}),$("#back-btn").on("click",function(){$("#soc").hide(),$("#search").show()})}function cleanListing(){var t,e;0==$("#right").find("tr").length&&$(".course-list").text("No courses matched your search criteria for this term."),$("#right").find("a").each(function(){if(-1!==$(this).attr("href").indexOf("reg.uci.edu/perl/")){var t=$(this).attr("href").split("?")[1];$(this).attr("href","/websoc/listing?"+t),$(this).removeAttr("target"),$(this).addClass("same-link")}else $(this).attr("target","_blank")});var o=$("#right").find("tr");$("#right").find("th").each(function(){var n=$(this);if("Textbooks"===n.text()?(t=n.index(),o.find("th:eq("+t+")").remove(),o.find("td:eq("+t+")").remove()):"Web"===n.text()&&(e=n.index(),o.find("th:eq("+e+")").remove(),o.find("td:eq("+e+")").remove()),t&&e)return!1}),o.each(function(){var t=$("td",this);t.attr("colspan")&&t.attr("colspan",14);var e=$("td:eq(0)",this);if("&nbsp;"==e.html()){e.remove();var o=$("td:eq(0)",this);"&nbsp;"==o.html()&&o.remove();var n=$("td:eq(2)",this);"&nbsp;"==n.html()&&"#fff0ff"==$(this).attr("bgcolor")&&n.remove()}var a=$("td:eq(12)",this);"&nbsp;"!=a.html()&&a.html("<a href='https://www.reg.uci.edu/enrollment/restrict_codes.html' target='_blank'>"+a.text()+"</a>");var r=$("td:eq(4)",this),i=r.text();if(-1!==i.indexOf(",")&&-1!==i.indexOf(".")){for(var l=r.html().split("<br>"),s=[],d=0;d<l.length;d++){var c=l[d].trim();if("STAFF"!=c){if(""!=c){var u=c.split(",")[0];-1!==u.indexOf("-")&&(u=c.split("-")[0]);var p="https://www.ratemyprofessors.com/search.jsp?queryoption=HEADER&queryBy=teacherName&schoolName=University+of+California+Irvine&schoolID=1074&query="+u;s.push('<a class="instructor-link" href="'+p+'" target="_blank">'+c+"</a>")}}else s.push("STAFF")}r.html(s.join("<br />"))}})}function toggleOptions(){var t=document.getElementById("moreOptions"),e=document.getElementById("moreOptionsButton");"none"===t.style.display?(t.style.display="block",e.innerText="Show Less Options..."):(t.style.display="none",e.innerText="Show More Options...")}function mobileRescale(){/Android|webOS|iPhone|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)&&($(".course-list").css("font-size","3vw"),$(".course-list").css("line-height","3vw"))}$(document).ready(function(){window.Split(["#left","#right"],{sizes:[45,55],gutterSize:10,minSize:20,elementStyle:function(t,e,o){return{width:"calc("+e+"% - "+1.5*o+"px)"}}}),$(".gutter").append('<i class="fas fa-ellipsis-v"></i>'),lscache.flushExpired(),$("#search-form").submit(function(t){$("#loading").show(),t.preventDefault();var e=lscache.get($("#search-form").serialize());e?(swapToListing(e),setupListingListeners(),mobileRescale()):$.ajax({url:$("#search-form").attr("action"),type:"GET",data:$("#search-form").serializeArray(),success:function(t){swapToListing(t),cleanListing(),setupListingListeners(),mobileRescale(),lscache.set($("#search-form").serialize(),$("#soc").html(),30)},error:function(){toastr.error("Cannot load classes")}}),lscache.flushExpired()}),$("#moreOptionsButton").checked&&toggleOptions(),$("#moreOptionsButton").on("click",function(){toggleOptions()}),/Android|webOS|iPhone|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)&&($("#resize-btn").addClass("active"),$("#right").hide(),$("#right").width($(document).width()),$("#right").css("margin-left","0px"),$("#left").width($(document).width()),$("#cal").width($(document).width()),$("#finals").width($(document).width()),$(".gutter").hide()),$(".btn").on("show.bs.popover",function(){$(".popover").each(function(){$(this).popover("hide")})}),$("body").on("click",function(t){0!==$(t.target).parents(".fc-event-container").length||0!==$(t.target).parents(".popover").length||0!==$(t.target).parents(".btn").length||$(t.target).hasClass("btn")||$(".popover").each(function(){$(this).popover("hide")})}),$("#whatsnew").popover({html:!0,title:"What's New! ðŸŽ‰",content:'<ul style="list-style-type:disc;">\t\t\t\t<li>Click on a calendar event for more course info</li>\t\t\t\t<li>Change course event color</li>\t\t\t\t<li>RateMyProfessor links</li>\t\t\t\t<li>View your finals\' schedule</li>\t\t\t\t<li>View all your courses\' info using the List button</li>\t\t\t\t<li>Create a custom event</li>\t\t\t\t<li>Enrolled unit counter</li>\t\t\t\t<li>Import schedule from Antplanner</li> \t\t\t\t<li>Resizable panes</li>\t\t\t\t</ul>\t\t\t\t<a href="https://goo.gl/forms/YdeevICkr4Ei6HHg1" target="_blank">Bugs or Suggestions?</a>',placement:"bottom",container:"body",boundary:"window"}),$("#save-btn").click(function(){localStorage.getItem("recentSchedules")||localStorage.setItem("recentSchedules",JSON.stringify([])),$("#save-btn").popover({trigger:"manual",html:!0,title:"Save Schedule",content:function(){return'<div class="input-group input-group-sm mb-3">\t\t\t\t\t\t<input id="save-input" value="'+(localStorage.getItem("username")?localStorage.getItem("username"):"")+'" type="text" class="form-control save-input" placeholder="Schedule Name" aria-label="Schedule\'s save name" aria-describedby="basic-addon2">\t\t\t\t\t\t<div class="input-group-append">\t\t\t\t\t\t\t<button id="save-button" class="btn btn-outline-primary" type="button">Submit</button>\t\t\t\t\t\t</div>\t\t\t\t\t</div>\t\t\t\t\t<div>'+arrToTable(localStorage.getItem("recentSchedules"))+"</div>"},placement:"bottom",container:"body",boundary:"window"}),$("#save-btn").popover("toggle")}),$("#save-btn").on("shown.bs.popover",function(){if(/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)){var t=localStorage.getItem(e)?localStorage.getItem(e):"",e=prompt("Please enter your username",t);e&&saveSchedule(e),$("#save-btn").popover("hide")}$("#save-input").focus(),$("#save-input").keypress(function(t){t||(t=window.event),"13"==(t.keyCode||t.which)&&(saveSchedule($("#save-input").val()),$("#save-btn").popover("hide"))}),$(".recentSchedule").on("click",function(){$("#save-input").val($(this).text()),$("#save-input").focus()}),$("#clearRecents").click(function(){localStorage.removeItem("recentSchedules"),localStorage.removeItem("username"),$("#save-btn").popover("hide")}),$("#save-button").click(function(){saveSchedule($("#save-input").val()),$("#save-btn").popover("hide")})}),$("#load-btn").click(function(){localStorage.getItem("recentSchedules")||localStorage.setItem("recentSchedules",JSON.stringify([])),$("#load-btn").popover({trigger:"manual",html:!0,title:"Load Schedule",content:function(){return'<div class="input-group input-group-sm mb-3">\t\t\t\t\t\t<input id="load-input" value="'+(localStorage.getItem("username")?localStorage.getItem("username"):"")+'" type="text" class="form-control" placeholder="Schedule Name" aria-label="Schedule\'s load name" aria-describedby="basic-addon2">\t\t\t\t\t\t<div class="input-group-append">\t\t\t\t\t\t\t<button id="load-button" class="btn btn-outline-primary" type="button">Submit</button>\t\t\t\t\t\t</div>\t\t\t\t\t</div>\t\t\t\t\t<div>'+arrToTable(localStorage.getItem("recentSchedules"))+"</div>"},placement:"bottom",container:"body",boundary:"window"}),$("#load-btn").popover("toggle")}),$("#load-btn").on("shown.bs.popover",function(){if(/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)){var t=localStorage.getItem("username")?localStorage.getItem("username"):"",e=prompt("Please enter your username",t);e&&loadSchedule(e),$("#load-btn").popover("hide")}$("#load-input").focus(),$("#load-input").keypress(function(t){t||(t=window.event),"13"==(t.keyCode||t.which)&&(loadSchedule($("#load-input").val()),$("#load-btn").popover("hide"))}),$(".recentSchedule").on("click",function(){$("#load-input").val($(this).text()),$("#load-input").focus()}),$("#clearRecents").click(function(){localStorage.removeItem("recentSchedules"),localStorage.removeItem("username"),$("#load-btn").popover("hide")}),$("#load-button").click(function(){loadSchedule($("#load-input").val()),$("#load-btn").popover("hide")})}),$("#load-ap-btn").popover({html:!0,title:"Import from Antplanner",content:'<div class="input-group input-group-sm mb-3">\t\t\t\t\t<div style="padding-bottom: 8px">Note: Not all course info will be available in event popup.</div>\t\t\t\t\t<input id="load-ap-input" type="text" class="form-control" placeholder="Schedule Name" aria-label="Schedule\'s AP load name" aria-describedby="basic-addon2">\t\t\t\t\t<div class="input-group-append">\t\t\t\t\t\t<button id="load-ap-button" class="btn btn-outline-primary" type="button">Submit</button>\t\t\t\t\t</div>\t\t\t\t</div>',placement:"bottom",container:"body",boundary:"window"}),$("#load-ap-btn").on("shown.bs.popover",function(){if(/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)){var t=localStorage.getItem("username")?localStorage.getItem("username"):"",e=prompt("Please enter your Antplanner username",t);e&&loadAPSchedule(e),$("#load-ap-btn").popover("hide")}$("#load-ap-input").focus(),$("#load-ap-input").keypress(function(t){t||(t=window.event),"13"==(t.keyCode||t.which)&&(loadAPSchedule($("#load-ap-input").val()),$("#load-ap-btn").popover("hide"))}),$("#load-ap-button").click(function(){loadAPSchedule($("#load-ap-input").val()),$("#load-ap-btn").popover("hide")})}),$("#print-btn").click(function(){if(-1!=navigator.userAgent.indexOf("Chrome")){switchToMainCalendar();var t=$("#left").outerWidth();$("#right").hide(),$("#left").outerWidth("99.5%"),$("#cal").css("width","100%"),$("th, td, tr").css("border","2px solid #bfbfbf"),$(".fc-minor").css("border-top","3px dotted #bfbfbf"),$("#resize-btn").removeClass("active"),document.title=$("#scheduleNameForPrint").html()?$("#scheduleNameForPrint").html():"Zotcourse - Schedule Planner for UCI",$(".fc-time-grid .fc-slats td").css("height","46"),$("#cal").fullCalendar("option","height",$("#left").outerHeight()-$("#upper").outerHeight()),$(".popover").each(function(){$(this).popover("hide")}),window.print(),$("#right").show(),$(".gutter").show(),$("#left").outerWidth(t),$("th, td, tr").css("border",""),$(".fc-time-grid .fc-slats td").css({height:($("#left").outerHeight()-$("#upper").outerHeight())/31}),document.title="Zotcourse - Schedule Planner for UCI"}else toastr.error("Printing is currently only supported in Chrome","Unsupported Browser")}),$("#clear-cal-btn").on("click",function(){$(".popover").each(function(){$(this).popover("hide")}),$("#cal").fullCalendar("removeEvents"),$("#finals").fullCalendar("removeEvents"),switchToMainCalendar(),$("#unitCounter").text(0)}),$("#resize-btn").click(async function(){$(".popover").each(function(){$(this).popover("hide")}),$(this).hasClass("active")?(/Android|webOS|iPhone|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)?($("#finals").animate({width:0},200,"swing"),$("#cal").animate({width:0},200,"swing"),await sleep(200),$("#left").width("0px"),$("#right").show()):($("#finals").animate({width:"100%"},200,"swing"),$("#cal").animate({width:"100%"},200,"swing"),await sleep(200),$("#soc").show(),$(".gutter").show()),$(this).removeClass("active")):(/Android|webOS|iPhone|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)?($("#right").hide(),$("#left").width($(document).width()),$("#cal").animate({width:$(document).width()},200,"swing"),$("#finals").animate({width:$(document).width()},200,"swing")):($("#soc").hide(),$(".gutter").hide(),$("#cal").animate({width:$(document).width()},200,"swing"),$("#finals").animate({width:$(document).width()},200,"swing")),$(this).addClass("active"))}),$("#finals-btn").click(function(){if($(".popover").each(function(){$(this).popover("hide")}),$(this).hasClass("active"))$("#finals").hide(),$("#cal").show(),$(this).removeClass("active"),$("#cal").fullCalendar("rerenderEvents");else{$("#finals").show(),$("#cal").hide(),$(this).addClass("active"),$("#finals").fullCalendar("removeEvents");var t=$("#cal").fullCalendar("clientEvents"),e=[],o=!1;for(var n in t)if(1!=t[n].eventType&&"TBA"==$.trim(t[n].final.replace(/&nbsp;/g,""))&&(o=!0),1!=t[n].eventType&&""!=$.trim(t[n].final.replace(/&nbsp;/g,""))&&"TBA"!=$.trim(t[n].final.replace(/&nbsp;/g,""))&&"N/A (due to import)"!=$.trim(t[n].final.replace(/&nbsp;/g,""))&&!(e.indexOf(t[n].groupId)>=0)){var a=FinalParsedCourseTime(t[n].final);$("#finals").fullCalendar("renderEvent",{id:t[n].id,groupId:t[n].groupId,start:a.beginHour+":"+a.beginMin,end:a.endHour+":"+a.endMin,title:t[n].title.split(/\s(.+)/)[1],dow:[a.weekDay],color:t[n].color,fullName:t[n].fullName,instructor:t[n].instructor,date:a.date}),e.push(t[n].groupId)}o&&toastr.warning("One of your courses have TBA finals. Please use the List buttton to re-add and update the course.","TBA Finals"),$("#finals").fullCalendar("rerenderEvents")}$(window).trigger("resize")}),$("#list-btn").click(function(){$(".popover").each(function(){$(this).popover("hide")});var t,e=$("#cal").fullCalendar("clientEvents"),o=[];for(var n in e)1!=e[n].eventType&&-1==o.indexOf(e[n].groupId)&&o.push(e[n].groupId);o.sort(),""==(t=o.join(","))?toastr.warning("Must have at least 1 course added.","Cannot List Courses"):($("#loading").show(),$.ajax({url:"/websoc/listing?YearTerm="+$("#list-btn").attr("data-term")+"&\t\t\t\tBreadth=ANY&Dept=&CourseCodes="+t+"&CourseNum=&Division=ANY&\t\t\t\tInstrName=&CourseTitle=&ClassType=ALL&Units=&Days=&StartTime=&EndTime=&\t\t\t\tFullCourses=ANY&ShowComments=on&ShowFinals=on",type:"GET",success:function(t){swapToListing(t),cleanListing(),setupListingListeners(),mobileRescale()},error:function(){toastr.error("Cannot load classes")}}))}),$("#export-btn").popover({html:!0,title:"Export to iCal",content:'<div class="input-group input-group-sm mb-3">\t\t\t\t\t<div style="padding-bottom: 8px">Downloads an .ics file which can import your courses into Google Calendar. \t\t\t\t\t<a target="_blank" href="https://support.google.com/calendar/answer/37118#import_to_gcal">Click here to learn how.</a></div>\t\t\t\t\t<div style="margin:auto;"><button id="export-button" class="btn btn-primary" type="button">Download</button></div>\t\t\t\t</div>',placement:"bottom",container:"body",boundary:"window"}),$("#export-btn").on("shown.bs.popover",function(){$("#export-button").click(function(){$(".popover").each(function(){$(this).popover("hide")});var t,e=$("#cal").fullCalendar("clientEvents"),o=parseInt($("#list-btn").attr("data-term").substring(0,4));for(var n in e)if(1!=e[n].eventType&&""!=e[n].final.replace(/&nbsp;/g,"").trim()&&"N/A (due to import)"!=e[n].final.replace(/&nbsp;/g,"")&&"TBA"!=e[n].final.replace(/&nbsp;/g,"").trim()){var a=FinalParsedCourseTime(e[n].final),r=(8-(t=new Date(o,MONTH_TO_INT[a.month],a.day,a.beginHour)).getDay())%7;[6,0,1].includes(t.getDay())&&(r+=7),t.setDate(t.getDate()+r),t.setDate(t.getDate()-77);break}if(null!=t){var i=[],l=ics();for(n in e)if(-1==i.indexOf([e[n].groupId,e[n].daysOfTheWeek].toString())){var s=new Date(t),d=e[n].daysOfTheWeek.sort();s.setDate(s.getDate()+(d[0]-1));var c=new Date(s);s.setHours(e[n].start.hours()),s.setMinutes(e[n].start.minutes()),c.setHours(e[n].end.hours()),c.setMinutes(e[n].end.minutes());var u={freq:"WEEKLY",count:10*e[n].daysOfTheWeek.length,byday:daysOfTheWeekToStr(d)};if(1==e[n].eventType)l.addEvent(e[n].title,"","",s,c,u);else{var p=e[n].location.match(/(\w|\s)+(?=<|$)/g)||[e[n].location];l.addEvent(e[n].title,"Course Title: "+e[n].fullName+"\\nInstructor: "+e[n].instructor+"\\nCode: "+e[n].groupId+"\\nFinal: "+(""!==e[n].final?e[n].final:"See Lecture"),p.toString(),s,c,u)}if(1!=e[n].eventType&&""!=e[n].final.replace(/&nbsp;/g,"").trim()&&"N/A (due to import)"!=e[n].final.replace(/&nbsp;/g,"")&&"TBA"!=e[n].final.replace(/&nbsp;/g,"").trim()){var h=FinalParsedCourseTime(e[n].final),m=new Date(o,MONTH_TO_INT[h.month],h.day,h.beginHour,h.beginMin),f=new Date(o,MONTH_TO_INT[h.month],h.day,h.endHour,h.endMin);l.addEvent("Final "+e[n].title.split(/\s(.+)/)[1],"Course Title: "+e[n].fullName+"\\nInstructor: "+e[n].instructor+"\\nCode: "+e[n].groupId,"Check portal.uci.edu",m,f)}i.push([e[n].groupId,e[n].daysOfTheWeek].toString())}l.download()}else toastr.warning("Must have at least 1 course with a final added.","Cannot Export Courses")})}),$("#event-btn").popover({html:!0,title:"Add a Custom Event",content:'<div>\t\t\t\t\t<input id="event-name" type="text" placeholder="Event Name" class="form-control form-control-lg">\t\t\t\t\t<div style="display: flex; justify-content: space-between; width:100%">\t\t\t\t\t<select id="event-start" class="time custom-select">\t\t\t\t\t<option value="07:00">7:00am</option>\t\t\t\t\t<option value="07:30">7:30am</option>\t\t\t\t\t<option value="08:00">8:00am</option>\t\t\t\t\t<option value="08:30">8:30am</option>\t\t\t\t\t<option value="09:00">9:00am</option>\t\t\t\t\t<option value="09:30">9:30am</option>\t\t\t\t\t<option value="10:00">10:00am</option>\t\t\t\t\t<option value="10:30">10:30am</option>\t\t\t\t\t<option value="11:00">11:00am</option>\t\t\t\t\t<option value="11:30">11:30am</option>\t\t\t\t\t<option value="12:00" selected>12:00pm</option>\t\t\t\t\t<option value="12:30">12:30pm</option>\t\t\t\t\t<option value="13:00">1:00pm</option>\t\t\t\t\t<option value="13:30">1:30pm</option>\t\t\t\t\t<option value="14:00">2:00pm</option>\t\t\t\t\t<option value="14:30">2:30pm</option>\t\t\t\t\t<option value="15:00">3:00pm</option>\t\t\t\t\t<option value="15:30">3:30pm</option>\t\t\t\t\t<option value="16:00">4:00pm</option>\t\t\t\t\t<option value="16:30">4:30pm</option>\t\t\t\t\t<option value="17:00">5:00pm</option>\t\t\t\t\t<option value="17:30">5:30pm</option>\t\t\t\t\t<option value="18:00">6:00pm</option>\t\t\t\t\t<option value="18:30">6:30pm</option>\t\t\t\t\t<option value="19:00">7:00pm</option>\t\t\t\t\t<option value="19:30">7:30pm</option>\t\t\t\t\t<option value="20:00">8:00pm</option>\t\t\t\t\t<option value="20:30">8:30pm</option>\t\t\t\t\t<option value="21:00">9:00pm</option>\t\t\t\t\t<option value="21:30">9:30pm</option>\t\t\t\t\t</select>\t\t\t\t\t<span style="padding-top: 10px; margin-left:10px; margin-right:10px">to</span>\t\t\t\t\t<select id="event-end" class="time custom-select">\t\t\t\t\t<option value="07:30">7:30am</option>\t\t\t\t\t<option value="08:00">8:00am</option>\t\t\t\t\t<option value="08:30">8:30am</option>\t\t\t\t\t<option value="09:00">9:00am</option>\t\t\t\t\t<option value="09:30">9:30am</option>\t\t\t\t\t<option value="10:00">10:00am</option>\t\t\t\t\t<option value="10:30">10:30am</option>\t\t\t\t\t<option value="11:00">11:00am</option>\t\t\t\t\t<option value="11:30">11:30am</option>\t\t\t\t\t<option value="12:00">12:00pm</option>\t\t\t\t\t<option value="12:30">12:30pm</option>\t\t\t\t\t<option value="13:00" selected>1:00pm</option>\t\t\t\t\t<option value="13:30">1:30pm</option>\t\t\t\t\t<option value="14:00">2:00pm</option>\t\t\t\t\t<option value="14:30">2:30pm</option>\t\t\t\t\t<option value="15:00">3:00pm</option>\t\t\t\t\t<option value="15:30">3:30pm</option>\t\t\t\t\t<option value="16:00">4:00pm</option>\t\t\t\t\t<option value="16:30">4:30pm</option>\t\t\t\t\t<option value="17:00">5:00pm</option>\t\t\t\t\t<option value="17:30">5:30pm</option>\t\t\t\t\t<option value="18:00">6:00pm</option>\t\t\t\t\t<option value="18:30">6:30pm</option>\t\t\t\t\t<option value="19:00">7:00pm</option>\t\t\t\t\t<option value="19:30">7:30pm</option>\t\t\t\t\t<option value="20:00">8:00pm</option>\t\t\t\t\t<option value="20:30">8:30pm</option>\t\t\t\t\t<option value="21:00">9:00pm</option>\t\t\t\t\t<option value="21:30">9:30pm</option>\t\t\t\t\t<option value="22:00">10:00pm</option>\t\t\t\t\t</select>\t\t\t\t\t</div>\t\t\t\t\t<div style="display: flex; justify-content: space-between; width:100%; margin-top: 10px" class="weekDays-selector">\t\t\t\t\t<input type="checkbox" name="weekday-check" data="1" id="weekday-mon" class="weekday" />\t\t\t\t\t<label for="weekday-mon">M</label>\t\t\t\t\t<input type="checkbox" name="weekday-check" data="2" id="weekday-tue" class="weekday" />\t\t\t\t\t<label for="weekday-tue">T</label>\t\t\t\t\t<input type="checkbox" name="weekday-check" data="3" id="weekday-wed" class="weekday" />\t\t\t\t\t<label for="weekday-wed">W</label>\t\t\t\t\t<input type="checkbox" name="weekday-check" data="4" id="weekday-thu" class="weekday" />\t\t\t\t\t<label for="weekday-thu">T</label>\t\t\t\t\t<input type="checkbox" name="weekday-check" data="5" id="weekday-fri" class="weekday" />\t\t\t\t\t<label for="weekday-fri">F</label>\t\t\t\t\t</div>\t\t\t\t\t<div style="display: flex;  justify-content: center;"><button id="event-button" class="btn btn-primary" type="button">Add Event</button></div>\t\t\t\t</div>',placement:"bottom",container:"body",boundary:"window"}),$("#event-btn").on("shown.bs.popover",function(){$("#event-button").click(function(){var t=$("input[name=weekday-check]:checked");weekDays=[];for(var e=0;e<t.length;e++)weekDays.push(parseInt($(t[e]).attr("data")));if($("#event-name").val().length<=0||$("#event-name").val().length>25)toastr.warning("Name must be between 1 and 25 characters.","Event Name");else if($("#event-start").val()>=$("#event-end").val())toastr.warning("Start time must come before end time.","Event Time");else if(0==weekDays.length)toastr.warning("Must have at least 1 weekday selected.","Event Weekday");else{var o=[{start:$("#event-start").val(),end:$("#event-end").val(),days:weekDays}];$("#cal").fullCalendar("renderEvent",{id:S4(),groupId:S4(),start:$("#event-start").val(),end:$("#event-end").val(),title:$("#event-name").val(),dow:weekDays,color:getRandomColorPair().color,daysOfTheWeek:weekDays,fullName:$("#event-name").val(),eventType:1,courseTimes:o}),switchToMainCalendar()}})}),$(window).resize(function(){$(".gutter").height($("#left").height()+"px"),$(".fc-time-grid .fc-slats td").css({height:($("body").outerHeight()-$("#upper").outerHeight())/31}),$("#cal").fullCalendar("option","height",$("#left").outerHeight()),$("#finals").fullCalendar("option","height",$("#left").outerHeight()),$(".popover").each(function(){$(this).popover("hide")})}),$("#cal").fullCalendar({weekends:!1,header:!1,themeSystem:"bootstrap4",defaultView:"agendaWeek",allDaySlot:!1,slotEventOverlap:!1,minTime:"07:00:00",maxTime:"22:00:00",columnHeaderFormat:"ddd",height:$("#left").outerHeight(),eventRender:function(t,e){var o=S4();$(".popover").each(function(){$(this).popover("hide")}),1==t.eventType?e.popover({html:!0,title:t.fullName?t.fullName:"",content:'<table style="width:100%; margin-bottom:3%">\t\t\t\t\t\t\t<tr>\t\t\t\t\t\t\t\t<td>Color</td>\t\t\t\t\t\t\t\t<td></td>\t\t\t\t\t\t\t\t<td align="right"><input id="colorpicker-'+o+'" type="text"/></td>\t\t\t\t\t\t\t</tr>\t\t\t\t\t\t\t</table>\t\t\t\t\t\t\t<button style="width:100%" class="btn btn-sm btn-outline-primary delete-event">Remove <i class="fas fa-trash-alt"></i></button>',trigger:"focus",placement:"right",container:"body"}):e.popover({html:!0,title:t.fullName?t.fullName:"",content:'<table style="width:100%; margin-bottom:3%;">\t\t\t\t\t\t\t<tr>\t\t\t\t\t\t\t\t<td>Name</td>\t\t\t\t\t\t\t\t<td></td>\t\t\t\t\t\t\t\t<td align="right">'+t.title+'</td>\t\t\t\t\t\t\t</tr>\t\t\t\t\t\t\t<tr>\t\t\t\t\t\t\t\t<td>Code</td>\t\t\t\t\t\t\t\t<td></td>\t\t\t\t\t\t\t\t<td align="right">'+t.groupId+'</td>\t\t\t\t\t\t\t</tr>\t\t\t\t\t\t\t<tr>\t\t\t\t\t\t\t\t<td>Location</td>\t\t\t\t\t\t\t\t<td></td>\t\t\t\t\t\t\t\t<td align="right">'+(t.location?t.location:"")+'</td>\t\t\t\t\t\t\t</tr>\t\t\t\t\t\t\t<tr>\t\t\t\t\t\t\t\t<td>Instructor</td>\t\t\t\t\t\t\t\t<td>&nbsp;&nbsp;</td>\t\t\t\t\t\t\t\t<td align="right">'+(t.instructor?createInstructorLinks(t.instructor):"N/A")+'</td>\t\t\t\t\t\t\t</tr>\t\t\t\t\t\t\t<tr>\t\t\t\t\t\t\t\t<td>Color</td>\t\t\t\t\t\t\t\t<td></td>\t\t\t\t\t\t\t\t<td align="right"><input id="colorpicker-'+o+'" type="text"/></td>\t\t\t\t\t\t\t</tr>\t\t\t\t\t\t\t</table>\t\t\t\t\t\t\t<button style="width:100%" class="btn btn-sm btn-outline-primary delete-event">Remove <i class="fas fa-trash-alt"></i></button>',trigger:"focus",placement:"right",container:"body"}),e.on("inserted.bs.popover",function(){$("#colorpicker-"+o).spectrum({color:t.color,showPaletteOnly:!0,togglePaletteOnly:!0,togglePaletteMoreText:"more",togglePaletteLessText:"less",hideAfterPaletteSelect:!0,preferredFormat:"hex",showInput:!0,palette:[["#C4A883","#A7A77D","#85AAA5","#94A2BE","#8997A5","#A992A9","#A88383","#E6804D","#F2A640","#E0C240","#BFBF4D","#8CBF40","#4CB052","#65AD89","#59BFB3","#668CD9","#668CB3","#8C66D9","#B373B3","#E67399","#D96666"]],change:function(e){for(var n in $("#colorpicker-"+o).spectrum("destroy"),$("#colorpicker-"+o).hide(),$("#cal").fullCalendar("removeEvents",t._id),t.courseTimes){var a=t.courseTimes[n];$("#cal").fullCalendar("renderEvent",{_id:t._id,id:t.id,groupId:t.groupId,start:a.start,end:a.end,title:t.title,dow:a.days,color:e.toHexString(),daysOfTheWeek:a.days,location:a.room,fullName:t.fullName,instructor:t.instructor,final:t.final,units:t.units,courseTimes:t.courseTimes,eventType:t.eventType})}}})}),e.on("hide.bs.popover",function(){$("#colorpicker-"+o).spectrum("destroy"),$("#colorpicker-"+o).hide()}),e.on("show.bs.popover",function(){$(".popover").each(function(){$(this).popover("hide")})})},eventClick:function(t){var e=$(this);e.popover("toggle"),$(".delete-event").click(function(){e.popover("dispose"),$("#cal").fullCalendar("removeEvents",t._id),t.units&&parseInt($("#unitCounter").text())-parseInt(t.units)>=0&&$("#unitCounter").text(parseInt($("#unitCounter").text())-parseInt(t.units))})}}),$("#finals").fullCalendar({header:!1,firstDay:6,themeSystem:"bootstrap4",defaultView:"agendaWeek",allDaySlot:!1,slotEventOverlap:!1,minTime:"07:00:00",maxTime:"22:00:00",columnHeaderFormat:"ddd",height:$("#left").outerHeight(),eventRender:function(t,e){$(".popover").each(function(){$(this).popover("hide")}),e.popover({html:!0,title:t.fullName?t.fullName:"",content:'<table style="width:100%">\t\t\t\t\t\t<tr>\t\t\t\t\t\t\t<td>Name</td>\t\t\t\t\t\t\t<td></td>\t\t\t\t\t\t\t<td align="right">'+t.title+'</td>\t\t\t\t\t\t</tr>\t\t\t\t\t\t<tr>\t\t\t\t\t\t\t<td>Code</td>\t\t\t\t\t\t\t<td></td>\t\t\t\t\t\t\t<td align="right">'+t.groupId+'</td>\t\t\t\t\t\t</tr>\t\t\t\t\t\t<tr>\t\t\t\t\t\t\t<td>Date</td>\t\t\t\t\t\t\t<td></td>\t\t\t\t\t\t\t<td align="right">'+t.date+'</td>\t\t\t\t\t\t</tr>\t\t\t\t\t\t<tr>\t\t\t\t\t\t\t<td>Instructor</td>\t\t\t\t\t\t\t<td>&nbsp;&nbsp;</td>\t\t\t\t\t\t\t<td align="right">'+(t.instructor?createInstructorLinks(t.instructor):"N/A")+"</td>\t\t\t\t\t\t</tr>\t\t\t\t\t\t</table>",trigger:"focus",placement:"right",container:"body"}),e.on("show.bs.popover",function(){$(".popover").each(function(){$(this).popover("hide")})})},eventClick:function(){$(this).popover("toggle")}}),$(".fc-time-grid .fc-slats td").css({height:$("#left").outerHeight()/31}),$(window).trigger("resize")});